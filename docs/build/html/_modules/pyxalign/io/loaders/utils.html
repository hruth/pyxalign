

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyxalign.io.loaders.utils &mdash; pyxalign 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            pyxalign
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">pyxalign</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pyxalign.io.loaders.utils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyxalign.io.loaders.utils</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">time</span><span class="w"> </span><span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyxalign.transformations.functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">image_crop_pad</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyxalign.io.loaders.enums</span><span class="w"> </span><span class="kn">import</span> <span class="n">LoaderType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyxalign.api.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">divisor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_ipython</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">QDialog</span><span class="p">,</span>
    <span class="n">QMessageBox</span><span class="p">,</span>
    <span class="n">QInputDialog</span><span class="p">,</span>
    <span class="n">QVBoxLayout</span><span class="p">,</span>
    <span class="n">QCheckBox</span><span class="p">,</span>
    <span class="n">QDialogButtonBox</span><span class="p">,</span>
    <span class="n">QLabel</span><span class="p">,</span>
    <span class="n">QWidget</span><span class="p">,</span>
    <span class="n">QScrollArea</span><span class="p">,</span>
    <span class="n">QApplication</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Qt</span>

<span class="n">border</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="s2">&quot;-&quot;</span>


<div class="viewcode-block" id="load_h5_group">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.xrf.base_loader.html#pyxalign.io.loaders.pear.base_loader.load_h5_group">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_h5_group</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">group_path</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load and print the structure and data of a group in an HDF5 file.</span>

<span class="sd">    :param file_path: Path to the HDF5 file.</span>
<span class="sd">    :param group_path: Path to the group in the HDF5 file (default is root).</span>
<span class="sd">    :return: A dictionary representing the group structure and data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">recursive_load</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
        <span class="n">group_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                <span class="c1"># Recursively load nested groups</span>
                <span class="n">group_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">recursive_load</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                <span class="c1"># Load dataset</span>
                <span class="n">group_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[()]</span>  <span class="c1"># Load the data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported HDF5 item: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">group_data</span>

    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5_file</span><span class="p">:</span>
        <span class="n">target_group</span> <span class="o">=</span> <span class="n">h5_file</span><span class="p">[</span><span class="n">group_path</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">recursive_load</span><span class="p">(</span><span class="n">target_group</span><span class="p">)</span></div>



<div class="viewcode-block" id="generate_experiment_description">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.generate_experiment_description">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_experiment_description</span><span class="p">(</span>
    <span class="n">option_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">options_info_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">options_info_type_string</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">experiment_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">option_string</span><span class="si">}</span><span class="s2"> (&quot;</span>
    <span class="k">if</span> <span class="n">options_info_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">experiment_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">options_info_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">options_info_type_string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">experiment_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">options_info_type_string</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">experiment_string</span> <span class="o">+</span> <span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="is_valid_option_provided">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.is_valid_option_provided">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_valid_option_provided</span><span class="p">(</span>
    <span class="n">use_option</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">options_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">allow_multiple_selections</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="c1"># Use pre-provided option if it was passed in</span>
    <span class="k">if</span> <span class="n">use_option</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">allow_multiple_selections</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">options_list</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">use_option</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">options_list</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">use_option</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">use_option</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Provided option is not allowed because it is not available in `options_list`&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span></div>



<div class="viewcode-block" id="prompt_input_processing">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.prompt_input_processing">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">prompt_input_processing</span><span class="p">(</span><span class="n">options_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">options_info_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
    <span class="c1"># Ensure inputs are lists</span>
    <span class="n">options_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">options_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options_info_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">options_info_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">options_info_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">options_list</span><span class="p">,</span> <span class="n">options_info_list</span></div>



<div class="viewcode-block" id="get_user_input">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.get_user_input">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_input</span><span class="p">(</span>
    <span class="n">options_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">allow_multiple_selections</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="o">...</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_user_input_gui</span><span class="p">(</span><span class="n">options_list</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">allow_multiple_selections</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_user_input_terminal</span><span class="p">(</span><span class="n">options_list</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">allow_multiple_selections</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_user_input_gui">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.get_user_input_gui">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_input_gui</span><span class="p">(</span>
    <span class="n">options_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">allow_multiple_selections</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get user input via PyQt5 dialogs.</span>

<span class="sd">    If allow_multiple_selections is False, show a QInputDialog to select a single option.</span>
<span class="sd">    If allow_multiple_selections is True, show a custom QDialog containing checkboxes</span>
<span class="sd">    within a scroll area for multiple selections.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (selection_idx, selection) : tuple</span>
<span class="sd">        selection_idx: int or list[int] (0-based indices of selected items)</span>
<span class="sd">        selection: str or list[str] (the corresponding selected item(s))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">allowed_inputs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">options_list</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">allow_multiple_selections</span><span class="p">:</span>
        <span class="c1"># Show a dialog with checkboxes for multiple selections (with a &quot;Select All&quot; option)</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">MultipleSelectionDialog</span><span class="p">(</span><span class="n">options_list</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span> <span class="o">==</span> <span class="n">QDialog</span><span class="o">.</span><span class="n">Accepted</span><span class="p">:</span>
            <span class="n">selected_indices</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_selected_indices</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">selected_indices</span><span class="p">:</span>
                <span class="c1"># If the user didn&#39;t select anything, raise an error or handle as needed</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No selections were made in the dialog.&quot;</span><span class="p">)</span>
            <span class="c1"># Convert to proper index list and retrieve option values</span>
            <span class="n">selection_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">selected_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">allowed_inputs</span><span class="p">]</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="p">[</span><span class="n">options_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">selection_idx</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">selection_idx</span><span class="p">,</span> <span class="n">selection</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Dialog was canceled; handle as you see fit</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;User canceled multiple-selection dialog.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Show a single-select dialog using QInputDialog</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">option</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">option</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">options_list</span><span class="p">)]</span>
        <span class="n">item_str</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Select One Option&quot;</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span> <span class="ow">and</span> <span class="n">item_str</span><span class="p">:</span>
            <span class="c1"># The user picked e.g. &quot;2. Some Value&quot;; parse out the index</span>
            <span class="n">index_str</span> <span class="o">=</span> <span class="n">item_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">selection_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index_str</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">selection_idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_inputs</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected index </span><span class="si">{</span><span class="n">selection_idx</span><span class="si">}</span><span class="s2"> is out of range.&quot;</span><span class="p">)</span>
                <span class="n">selection</span> <span class="o">=</span> <span class="n">options_list</span><span class="p">[</span><span class="n">selection_idx</span><span class="p">]</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">selection_idx</span><span class="p">,</span> <span class="n">selection</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not parse the user&#39;s selection index.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;User canceled single-selection dialog.&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="MultipleSelectionDialog">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.MultipleSelectionDialog">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MultipleSelectionDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A QDialog that displays a series of checkboxes for multiple selection from a list,</span>
<span class="sd">    wrapped in a scroll area, including a &quot;Select All&quot; checkbox.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">QWidget</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Select Multiple Options&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>

        <span class="c1"># Add a prompt at the top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_prompt</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_prompt</span><span class="p">)</span>

        <span class="c1"># Create a scroll area to wrap the checkboxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Widget that will contain the checkboxes</span>
        <span class="n">container_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">container_widget</span><span class="p">)</span>

        <span class="c1"># &quot;Select All&quot; checkbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb_select_all</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;Select All&quot;</span><span class="p">,</span> <span class="n">container_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb_select_all</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_select_all_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_select_all</span><span class="p">)</span>

        <span class="c1"># Create checkboxes for each option</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_checkboxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">option</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">options_list</span><span class="p">):</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">option</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">container_widget</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">option_checkboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">container_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="n">container_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="p">)</span>

        <span class="c1"># Add standard dialog buttons (OK/Cancel)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_box</span> <span class="o">=</span> <span class="n">QDialogButtonBox</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_box</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_box</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_box</span><span class="p">)</span>

<div class="viewcode-block" id="MultipleSelectionDialog.on_select_all_changed">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.MultipleSelectionDialog.on_select_all_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_select_all_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When &#39;Select All&#39; is checked, all individual checkboxes become checked and disabled.</span>
<span class="sd">        When &#39;Select All&#39; is unchecked, they become unchecked and re-enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_checkboxes</span><span class="p">:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_checkboxes</span><span class="p">:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="MultipleSelectionDialog.get_selected_indices">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.MultipleSelectionDialog.get_selected_indices">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_selected_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of indices corresponding to checked options.</span>
<span class="sd">        If &#39;Select All&#39; is checked, return the indices of all option checkboxes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_select_all</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">option_checkboxes</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">option_checkboxes</span><span class="p">)</span> <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()]</span></div>
</div>



<div class="viewcode-block" id="get_user_input_terminal">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.get_user_input_terminal">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_input_terminal</span><span class="p">(</span>
    <span class="n">options_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">allow_multiple_selections</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="o">...</span><span class="p">]:</span>
    <span class="n">allowed_inputs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">options_list</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">border</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">USER INPUT NEEDED</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># user_input = input(prompt)</span>
            <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter input(s):&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">allow_multiple_selections</span><span class="p">:</span>
                <span class="n">selection_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parse_space_delimited_integers</span><span class="p">(</span><span class="n">user_input</span><span class="p">)]</span>
                <span class="n">is_input_allowed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">idx</span> <span class="ow">in</span> <span class="n">allowed_inputs</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">selection_idx</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selection_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">is_input_allowed</span> <span class="o">=</span> <span class="n">selection_idx</span> <span class="ow">in</span> <span class="n">allowed_inputs</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_input_allowed</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">allow_multiple_selections</span><span class="p">:</span>
                    <span class="c1"># Get a list of the selected options</span>
                    <span class="n">selection</span> <span class="o">=</span> <span class="p">[</span><span class="n">options_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">selection_idx</span><span class="p">]</span>
                    <span class="n">selection_string</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">selection_idx</span><span class="p">,</span> <span class="n">selection</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="n">selection_string</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">selection_string</span><span class="p">)</span>
                    <span class="n">selection_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Selected options:</span><span class="se">\n</span><span class="si">{</span><span class="n">selection_string</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">selection</span> <span class="o">=</span> <span class="n">options_list</span><span class="p">[</span><span class="n">selection_idx</span><span class="p">]</span>
                    <span class="n">selection_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Selected option </span><span class="si">{</span><span class="n">selection_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">selection</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">selection_string</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">border</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">selection_idx</span><span class="p">,</span> <span class="n">selection</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">allow_multiple_selections</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_input</span><span class="si">}</span><span class="s2"> is not a valid input. Please enter a space delimited list &quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;whose elements are between 1 and </span><span class="si">{</span><span class="n">allowed_inputs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_input</span><span class="si">}</span><span class="s2"> is not a valid input. &quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;Please enter a number 1 through </span><span class="si">{</span><span class="n">allowed_inputs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
                    <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span></div>



<div class="viewcode-block" id="generate_input_user_prompt">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.xrf.base_loader.html#pyxalign.io.loaders.pear.base_loader.generate_input_user_prompt">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_input_user_prompt</span><span class="p">(</span>
    <span class="n">load_object_type_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">options_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">allow_multiple_selections</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">options_info_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">options_info_type_string</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prepend_option_with</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_option</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">select_all_info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">select_all_by_default</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
    
    <span class="n">provided_option</span> <span class="o">=</span> <span class="n">is_valid_option_provided</span><span class="p">(</span><span class="n">use_option</span><span class="p">,</span> <span class="n">options_list</span><span class="p">,</span> <span class="n">allow_multiple_selections</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">provided_option</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">provided_option</span>
    <span class="k">if</span> <span class="n">select_all_by_default</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">allow_multiple_selections</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">options_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">options_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># select_all_string = &quot;select all&quot;</span>
    <span class="n">select_all_string</span> <span class="o">=</span> <span class="s2">&quot;load all&quot;</span>
    <span class="k">if</span> <span class="n">select_all_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">select_all_info</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>


    <span class="n">options_list</span><span class="p">,</span> <span class="n">options_info_list</span> <span class="o">=</span> <span class="n">prompt_input_processing</span><span class="p">(</span><span class="n">options_list</span><span class="p">,</span> <span class="n">options_info_list</span><span class="p">)</span>

    <span class="c1"># Generate the user prompt</span>
    <span class="k">if</span> <span class="n">allow_multiple_selections</span><span class="p">:</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Select the </span><span class="si">{</span><span class="n">load_object_type_string</span><span class="si">}</span><span class="s2"> to load</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prompt</span> <span class="o">+=</span> <span class="s2">&quot;Enter inputs as a series of integers seperated by spaces:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Select the </span><span class="si">{</span><span class="n">load_object_type_string</span><span class="si">}</span><span class="s2"> to load:</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">allow_multiple_selections</span> <span class="ow">and</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">options_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">select_all_string</span><span class="p">]</span> <span class="o">+</span> <span class="n">options_list</span>
        <span class="n">options_info_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">options_info_list</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">options_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">option_string</span> <span class="o">==</span> <span class="n">select_all_string</span><span class="p">:</span>
            <span class="n">prompt</span> <span class="o">+=</span> <span class="n">generate_experiment_description</span><span class="p">(</span><span class="n">option_string</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prepend_option_with</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">option_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prepend_option_with</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">option_string</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">prompt</span> <span class="o">+=</span> <span class="n">generate_experiment_description</span><span class="p">(</span>
                <span class="n">option_string</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">options_info_list</span><span class="p">,</span> <span class="n">options_info_type_string</span>
            <span class="p">)</span>

    <span class="c1"># Prompt the user to make a selection</span>
    <span class="n">selection_idx</span><span class="p">,</span> <span class="n">selection</span> <span class="o">=</span> <span class="n">get_user_input</span><span class="p">(</span>
        <span class="n">options_list</span><span class="p">,</span>
        <span class="n">prompt</span><span class="p">,</span>
        <span class="n">allow_multiple_selections</span><span class="o">=</span><span class="n">allow_multiple_selections</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">allow_multiple_selections</span> <span class="ow">and</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Remove &quot;select all&quot; entry from options list</span>
        <span class="n">options_list</span> <span class="o">=</span> <span class="n">options_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># Check if &quot;select all&quot; in selection</span>
        <span class="k">if</span> <span class="n">select_all_string</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">options_list</span>
            <span class="n">selection_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">options_list</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">selection_idx</span><span class="p">,</span> <span class="n">selection</span></div>



<div class="viewcode-block" id="parse_space_delimited_integers">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.parse_space_delimited_integers">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_space_delimited_integers</span><span class="p">(</span><span class="n">input_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse a space-delimited string of integers.</span>

<span class="sd">    This function checks if the input string is a valid space-delimited</span>
<span class="sd">    string of integers. If valid, it converts the string into a list of integers.</span>
<span class="sd">    If invalid, it returns None.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input_string : str</span>
<span class="sd">        The input string to validate and parse.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list of int or None</span>
<span class="sd">        A list of integers if the input string is valid, otherwise None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">]</span></div>



<div class="viewcode-block" id="get_boolean_user_input">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.xrf.base_loader.html#pyxalign.io.loaders.pear.base_loader.get_boolean_user_input">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_boolean_user_input</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_boolean_user_input_gui</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_boolean_user_input_terminal</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_boolean_user_input_terminal">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.get_boolean_user_input_terminal">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_boolean_user_input_terminal</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s2"> (y/n): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">user_input</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">}:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Selected: y&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">user_input</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">}:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Selected: n&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid input. Please enter &#39;y&#39; or &#39;n&#39;.&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_boolean_user_input_gui">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.get_boolean_user_input_gui">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_boolean_user_input_gui</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a boolean user input via a Yes/No QMessageBox.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the user selects &#39;Yes&#39;, otherwise False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Question</span><span class="p">)</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Confirm&quot;</span><span class="p">)</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span></div>



<div class="viewcode-block" id="convert_projection_dict_to_array">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.xrf.api.html#pyxalign.io.loaders.pear.base_loader.convert_projection_dict_to_array">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_projection_dict_to_array</span><span class="p">(</span>
    <span class="n">projections</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">new_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">repair_orientation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">pad_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
    <span class="n">pad_with_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">delete_projection_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="c1"># Note: this always does some in-place replacement of the</span>
    <span class="c1"># passed in dict. I will fix this in a later version.</span>
    <span class="k">if</span> <span class="n">pad_with_mode</span><span class="p">:</span>
        <span class="n">pad_mode</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span>

    <span class="c1"># Reorient the projections -- only needed for specific data</span>
    <span class="c1"># sets where some projections are 90 degrees off from where they</span>
    <span class="c1"># should be</span>
    <span class="k">if</span> <span class="n">repair_orientation</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rotating and flipping some projections...&quot;</span><span class="p">)</span>
        <span class="n">target_aspect_ratio</span> <span class="o">=</span> <span class="n">projections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">projections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">projection</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">projections</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">projection</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">projection</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Can try to change this aspect ratio if having issues later.</span>
            <span class="n">reorient_this_projection</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_aspect_ratio</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">aspect_ratio</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">target_aspect_ratio</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">aspect_ratio</span> <span class="o">&lt;</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">reorient_this_projection</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reorienting projection&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="n">projections</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">projection</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rotating and flipping some projections...Completed&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">new_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">new_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">projection</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">projection</span> <span class="ow">in</span> <span class="n">projections</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span>

    <span class="c1"># Force new shape to be compatible with downsampling functions with</span>
    <span class="c1"># downsampling up to divisor</span>
    <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">new_shape</span> <span class="o">/</span> <span class="p">(</span><span class="n">divisor</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">divisor</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projection array shape: </span><span class="si">{</span><span class="n">new_shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize the projections array</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">projections</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">projections_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">projections</span><span class="p">),</span> <span class="o">*</span><span class="n">new_shape</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">projections</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="c1"># Fix projections dimensions through cropping and padding</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fixing projections dimensions...&quot;</span><span class="p">)</span>
    <span class="c1"># for projection in tqdm(projections.values()):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">projection</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">projections</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">projections</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">pad_with_mode</span><span class="p">:</span>
            <span class="n">pad_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">projection</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">mode</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pad_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">projections_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_crop_pad</span><span class="p">(</span>
            <span class="n">projection</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pad_mode</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="n">pad_value</span>
        <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fixing projections dimensions...Completed&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">projections_array</span></div>



<div class="viewcode-block" id="select_loader_type_from_prompt">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.select_loader_type_from_prompt">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">select_loader_type_from_prompt</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">LoaderType</span><span class="p">:</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">loader_type</span> <span class="o">=</span> <span class="n">generate_input_user_prompt</span><span class="p">(</span>
        <span class="n">load_object_type_string</span><span class="o">=</span><span class="s2">&quot;loader type&quot;</span><span class="p">,</span>
        <span class="n">options_list</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">LoaderType</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">loader_type</span></div>



<div class="viewcode-block" id="parallel_load_all_projections">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.xrf.base_loader.html#pyxalign.io.loaders.pear.base_loader.parallel_load_all_projections">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parallel_load_all_projections</span><span class="p">(</span>
    <span class="n">file_paths</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">n_processes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">projection_loading_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
    <span class="s2">&quot;Use a process pool to load all of the projections&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading projections into list...&quot;</span><span class="p">)</span>
        <span class="n">t_0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">n_processes</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
            <span class="n">projections_map</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">projection_loading_function</span><span class="p">,</span> <span class="n">file_paths</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">projections</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">file_paths</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">projections_map</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projection loading complete. Duration: </span><span class="si">{</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t_0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">projections</span></div>



<div class="viewcode-block" id="count_digits">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.count_digits">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">count_digits</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span></div>



<div class="viewcode-block" id="extract_s_digit_strings">
<a class="viewcode-back" href="../../../../api/_autosummary/pyxalign.io.loaders.utils.html#pyxalign.io.loaders.pear.base_loader.extract_s_digit_strings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">extract_s_digit_strings</span><span class="p">(</span><span class="n">strings</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^S\d+$&quot;</span>  <span class="c1"># Matches &#39;S&#39; followed by one or more digits</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">s</span><span class="p">)]</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Argonne National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>