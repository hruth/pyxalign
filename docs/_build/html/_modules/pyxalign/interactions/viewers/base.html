<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pyxalign.interactions.viewers.base &#8212; pyxalign 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../../_static/documentation_options.js?v=01f34227"></script>
    <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for pyxalign.interactions.viewers.base</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ctypes</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArgumentError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">index</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">re</span><span class="w"> </span><span class="kn">import</span> <span class="n">L</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="kn">import</span> <span class="n">Spinbox</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">ParamSpec</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cupy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">bisect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyxalign.api.options.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArrayViewerOptions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">QWidget</span><span class="p">,</span>
    <span class="n">QVBoxLayout</span><span class="p">,</span>
    <span class="n">QHBoxLayout</span><span class="p">,</span>
    <span class="n">QLayout</span><span class="p">,</span>
    <span class="n">QSlider</span><span class="p">,</span>
    <span class="n">QLabel</span><span class="p">,</span>
    <span class="n">QSpinBox</span><span class="p">,</span>
    <span class="n">QPushButton</span><span class="p">,</span>
    <span class="n">QApplication</span><span class="p">,</span>
    <span class="n">QSpacerItem</span><span class="p">,</span>
    <span class="n">QSizePolicy</span><span class="p">,</span>
    <span class="n">QFrame</span><span class="p">,</span>
    <span class="n">QCheckBox</span><span class="p">,</span>
    <span class="n">QScrollArea</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Qt</span><span class="p">,</span>
    <span class="n">QTimer</span><span class="p">,</span>
    <span class="n">QRunnable</span><span class="p">,</span>
    <span class="n">pyqtSlot</span><span class="p">,</span>
    <span class="n">QThreadPool</span><span class="p">,</span>
    <span class="n">pyqtSignal</span><span class="p">,</span>
    <span class="n">QObject</span><span class="p">,</span>
    <span class="n">QEventLoop</span><span class="p">,</span>
    <span class="n">QThread</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt5.QtGui</span><span class="w"> </span><span class="kn">import</span> <span class="n">QPalette</span><span class="p">,</span> <span class="n">QColor</span><span class="p">,</span> <span class="n">QValidator</span>

<span class="c1"># Matplotlib imports remain here, but are not used in ArrayViewer anymore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.backends.backend_qt5agg</span><span class="w"> </span><span class="kn">import</span> <span class="n">FigureCanvasQTAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.backends.backend_qt5</span><span class="w"> </span><span class="kn">import</span> <span class="n">NavigationToolbar2QT</span> <span class="k">as</span> <span class="n">NavigationToolbar</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.figure</span><span class="w"> </span><span class="kn">import</span> <span class="n">Figure</span>

<span class="c1"># New import for using pyqtgraph</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyqtgraph</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pg</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">WorkerThread</span><span class="p">(</span><span class="n">QThread</span><span class="p">):</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>  <span class="c1"># signal indicating multi_thread_func has completed</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">multi_thread_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">R</span><span class="p">],</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_thread_func</span> <span class="o">=</span> <span class="n">multi_thread_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi_thread_func</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Thread complete&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MultiThreadedWidget</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multi_thread_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">R</span><span class="p">],</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_thread_func</span> <span class="o">=</span> <span class="n">multi_thread_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exception_received</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">R</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multi_thread_func</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="s2">&quot;Cannot start multi-threading, valid function was not provided.&quot;</span><span class="p">)</span>

        <span class="c1"># create an event loop in the main thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_loop</span> <span class="o">=</span> <span class="n">QEventLoop</span><span class="p">()</span>
        <span class="c1"># create the worker thread that will run the projection matching alignment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker_thread</span> <span class="o">=</span> <span class="n">WorkerThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multi_thread_func</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># connect signals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker_thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_thread_finished</span><span class="p">)</span>
        <span class="c1"># start worker thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="c1"># block main thread until the worker finishes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_loop</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker_thread</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_on_thread_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">R</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_loop</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ArrayViewer</span><span class="p">(</span><span class="n">MultiThreadedWidget</span><span class="p">):</span>
    <span class="c1"># Make array3d optional with a default of None</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">array3d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># changed to Optional and given a default value</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayViewerOptions</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">multi_thread_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">extra_title_strings_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">process_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">multi_thread_func</span><span class="o">=</span><span class="n">multi_thread_func</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_title_strings_list</span> <span class="o">=</span> <span class="n">extra_title_strings_list</span>
        <span class="k">if</span> <span class="n">process_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">array3d</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_func</span> <span class="o">=</span> <span class="n">process_func</span>

        <span class="c1"># Only convert array if array3d is provided</span>
        <span class="k">if</span> <span class="n">array3d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_array_module</span><span class="p">(</span><span class="n">array3d</span><span class="p">)</span> <span class="o">==</span> <span class="n">cp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">array3d</span> <span class="o">=</span> <span class="n">array3d</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">array3d</span> <span class="o">=</span> <span class="n">array3d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If no array is given, store None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">array3d</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sort_idx</span> <span class="o">=</span> <span class="n">sort_idx</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">ArrayViewerOptions</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>

        <span class="c1"># If array is given, use its shape. Otherwise, default to 1 to avoid errors.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array3d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array3d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">slider_axis</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_frames</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">playing</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Create a pyqtgraph GraphicsLayoutWidget to hold the image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics_layout</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">GraphicsLayoutWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_layout</span><span class="o">.</span><span class="n">addPlot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_item</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">ImageItem</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_item</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_item</span><span class="o">.</span><span class="n">setAspectLocked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Create a checkbox for auto scaling the image intensities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_clim_check_box</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;Enable amplitude rescaling&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_clim_check_box</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QCheckBox {font-size: 15px;}&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_clim_check_box</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_frame</span><span class="p">)</span>

        <span class="c1"># Create index selection widget (slider, spinbox, play button, etc.)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexing_widget</span> <span class="o">=</span> <span class="n">IndexSelectorWidget</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_frames</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">start_index</span><span class="p">,</span>
            <span class="n">additional_spinbox_indexing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">additional_spinbox_indexing</span><span class="p">,</span>
            <span class="n">additional_spinbox_title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">additional_spinbox_titles</span><span class="p">,</span>
            <span class="n">sort_idx</span><span class="o">=</span><span class="n">sort_idx</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spinbox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexing_widget</span><span class="o">.</span><span class="n">slider</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexing_widget</span><span class="o">.</span><span class="n">spinbox</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexing_widget</span><span class="o">.</span><span class="n">play_button</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexing_widget</span><span class="o">.</span><span class="n">play_timer</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinbox</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_play</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_frame</span><span class="p">)</span>

        <span class="c1"># Main layout</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="c1"># In the original code, a matplotlib toolbar was added, but we omit it for pyqtgraph usage</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_clim_check_box</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphics_layout</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexing_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

        <span class="c1"># Font and style adjustments</span>
        <span class="n">small_style</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QWidget {</span>
<span class="s2">                font-size: 14px;</span>
<span class="s2">            }</span>
<span class="s2">            QSlider::groove:horizontal {</span>
<span class="s2">                height: 4px;</span>
<span class="s2">            }</span>
<span class="s2">            QSlider::handle:horizontal {</span>
<span class="s2">                width: 8px;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">small_style</span><span class="p">)</span>

        <span class="c1"># If array3d was provided, show the initial image</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array3d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display_frame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">start_index</span><span class="p">)</span>
            <span class="c1"># force scaling</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_item</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="n">autoLevels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">display_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_autolim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display a given slice (frame) from array3d.&quot;&quot;&quot;</span>
        <span class="c1"># Only display if we have an array</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array3d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_item</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;No data loaded&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_idx</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_index</span> <span class="o">=</span> <span class="n">index</span>

        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array3d</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="n">plot_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">slider_axis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_array_module</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="o">==</span> <span class="n">cp</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_func</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Update pyqtgraph image</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_clim_check_box</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">or</span> <span class="n">force_autolim</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_item</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="n">autoLevels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_item</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="n">autoLevels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Update title</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;span style=&#39;color:#B0E6F7&#39;&gt;Index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra_title_strings_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra_title_strings_list</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&lt;b&gt;&quot;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s2">&quot;&lt;/b&gt;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_item</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">force_autolim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_frame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">force_autolim</span><span class="o">=</span><span class="n">force_autolim</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">toggle_play</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">playing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Play&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Pause&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playing</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">playing</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">next_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">next_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_frames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">next_idx</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_autolim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">force_autolim</span><span class="o">=</span><span class="n">force_autolim</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_index_externally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reinitialize_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">array3d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">extra_title_strings_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_additional_spinbox_indexing</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_selected_value_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">process_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Re-initialize the viewer with a new array or sort indices.&quot;&quot;&quot;</span>
        <span class="c1"># Only process the new array if provided</span>
        <span class="k">if</span> <span class="n">array3d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">process_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">array3d</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">process_func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">process_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_func</span> <span class="o">=</span> <span class="n">process_func</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">array3d</span> <span class="o">=</span> <span class="n">array3d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sort_idx</span> <span class="o">=</span> <span class="n">sort_idx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extra_title_strings_list</span> <span class="o">=</span> <span class="n">extra_title_strings_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array3d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">slider_axis</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_frames</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinbox</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_frames</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># refresh the frame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_frame</span><span class="p">(</span><span class="n">force_autolim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># update the other boxes</span>
            <span class="k">if</span> <span class="n">new_additional_spinbox_indexing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_selected_value_list</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">arr</span><span class="p">[</span><span class="n">sort_idx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spinbox</span><span class="o">.</span><span class="n">value</span><span class="p">()]]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">new_additional_spinbox_indexing</span>
                <span class="p">]</span>
                <span class="c1"># print(new_selected_value_list)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indexing_widget</span><span class="o">.</span><span class="n">update_additional_spinbox_indexing</span><span class="p">(</span>
                    <span class="n">new_indexing</span><span class="o">=</span><span class="n">new_additional_spinbox_indexing</span><span class="p">,</span>
                    <span class="n">sort_idx</span><span class="o">=</span><span class="n">sort_idx</span><span class="p">,</span>
                    <span class="n">new_selected_value_list</span><span class="o">=</span><span class="n">new_selected_value_list</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show the widget.&quot;&quot;&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show the widget.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">LinkedArrayViewer</span><span class="p">(</span><span class="n">MultiThreadedWidget</span><span class="p">):</span>
    <span class="c1"># Make array3d optional with a default of None</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">array_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayViewerOptions</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">multi_thread_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">extra_title_strings_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">process_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">multi_thread_func</span><span class="o">=</span><span class="n">multi_thread_func</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># main layout</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="c1"># create array viewers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array_viewer_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">array3d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">array_list</span><span class="p">):</span>
            <span class="n">array_viewer</span> <span class="o">=</span> <span class="n">ArrayViewer</span><span class="p">(</span>
                <span class="n">array3d</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
                <span class="n">sort_idx</span><span class="o">=</span><span class="n">sort_idx</span><span class="p">,</span>
                <span class="n">multi_thread_func</span><span class="o">=</span><span class="n">multi_thread_func</span><span class="p">,</span>
                <span class="n">extra_title_strings_list</span><span class="o">=</span><span class="n">extra_title_strings_list</span><span class="p">,</span>
                <span class="n">process_func</span><span class="o">=</span><span class="n">process_func</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">array_viewer_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">array_viewer</span><span class="p">]</span>
            <span class="c1"># connect all sliders</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">array_viewer</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array_viewer_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">array_viewer_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">array_viewer</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">array_viewer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">IndexSelectorWidget</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">num_frames</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">start_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_play_button</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">additional_spinbox_indexing</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">additional_spinbox_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">QWidget</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_spinboxes_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ValidatedSpinBox</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">start_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Create a slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">num_frames</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">start_index</span><span class="p">)</span>

        <span class="c1"># SpinBox (editable + arrows)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinbox</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">()</span>
        <span class="c1"># self.spinbox = ValidatedSpinBox(</span>
        <span class="c1">#     allowed_values=np.arange(0, num_frames, dtype=int)</span>
        <span class="c1"># )  # QSpinBox()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinbox</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinbox</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">num_frames</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinbox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">start_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinbox</span><span class="o">.</span><span class="n">setValue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinbox</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">)</span>
        <span class="c1"># add spinbox to layout with label</span>
        <span class="n">main_spinbox_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">main_spinbox_widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">QVBoxLayout</span><span class="p">())</span>
        <span class="n">main_spinbox_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">main_spinbox_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">getContentsMargins</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="p">)</span>
        <span class="n">main_spinbox_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinbox</span><span class="p">)</span>
        <span class="n">main_spinbox_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">))</span>

        <span class="c1"># Play button</span>
        <span class="k">if</span> <span class="n">include_play_button</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Play&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            QPushButton {</span>
<span class="s2">                font-size: 14px;</span>
<span class="s2">                padding: 3px 6px;    /* Inner spacing (top/bottom, left/right) */</span>
<span class="s2">                min-width: 60px;     /* Minimum width */</span>
<span class="s2">                min-height: 20px;    /* Minimum height */</span>
<span class="s2">                text-align: center;  /* Text alignment */</span>
<span class="s2">                padding: 3px 6px;    /* Inner spacing (top/bottom, left/right) */</span>
<span class="s2">                min-width: 60px;     /* Minimum width */</span>
<span class="s2">                min-height: 20px;    /* Minimum height */</span>
<span class="s2">                text-align: center;  /* Text alignment */</span>
<span class="s2">            }</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">playback_speed_spin</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">playback_speed_spin</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Set a reasonable range</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">playback_speed_spin</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">playback_speed_spin</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_playback_speed_changed</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Play&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_button</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

        <span class="c1"># Layout for spinbox and optional play button</span>
        <span class="n">spin_play_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spin_play_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spin_play_layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">spin_play_layout</span><span class="o">.</span><span class="n">getContentsMargins</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">spin_play_widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spin_play_layout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_play_button</span><span class="p">:</span>
            <span class="c1"># A widget is made for the play button purely so I can</span>
            <span class="c1"># align it better on the gui</span>
            <span class="n">play_button_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
            <span class="n">play_button_widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">QVBoxLayout</span><span class="p">())</span>
            <span class="n">play_button_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">play_button</span><span class="p">)</span>
            <span class="n">play_button_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span>
            <span class="n">play_button_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">play_button_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">getContentsMargins</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spin_play_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">play_button_widget</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignTop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spin_play_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">main_spinbox_widget</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignLeft</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignTop</span><span class="p">)</span>

        <span class="c1"># add more spinboxes, like one for scan numbers in the case</span>
        <span class="c1"># of the ProjectionViewer, if specified</span>
        <span class="k">if</span> <span class="n">additional_spinbox_indexing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">indexing</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">additional_spinbox_indexing</span><span class="p">):</span>
                <span class="n">sbox</span> <span class="o">=</span> <span class="n">ValidatedSpinBox</span><span class="p">(</span><span class="n">allowed_values</span><span class="o">=</span><span class="n">indexing</span><span class="p">[</span><span class="n">sort_idx</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extra_spinboxes_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">sbox</span><span class="p">]</span>
                <span class="n">sbox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">indexing</span><span class="p">[</span><span class="n">sort_idx</span><span class="p">[</span><span class="n">start_index</span><span class="p">]])</span>
                <span class="n">sbox</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">indexing</span><span class="p">))</span>
                <span class="n">sbox</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">indexing</span><span class="p">))</span>

                <span class="c1"># link to primary indexing box</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">update_extra_from_primary</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">sbox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">sbox</span><span class="o">.</span><span class="n">allowed_values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">update_primary_from_extra</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sbox</span><span class="o">.</span><span class="n">allowed_values</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">update_extra_from_primary</span><span class="p">)</span>
                <span class="n">sbox</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">update_primary_from_extra</span><span class="p">)</span>

                <span class="n">extra_sbox_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
                <span class="n">extra_sbox_widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">QVBoxLayout</span><span class="p">())</span>
                <span class="n">extra_sbox_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_sbox_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">getContentsMargins</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="p">)</span>
                <span class="n">extra_sbox_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">sbox</span><span class="p">)</span>
                <span class="n">extra_sbox_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="n">additional_spinbox_title</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="c1"># add to spin-play layout</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spin_play_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span>
                    <span class="n">extra_sbox_widget</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignLeft</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignTop</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spin_play_layout</span><span class="o">.</span><span class="n">addSpacerItem</span><span class="p">(</span>
            <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">include_play_button</span><span class="p">:</span>
            <span class="n">playback_speed_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
            <span class="n">playback_speed_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
            <span class="n">playback_speed_widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">playback_speed_layout</span><span class="p">)</span>

            <span class="n">playback_speed_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Playback Speed (Hz)&quot;</span><span class="p">)</span>
            <span class="n">playback_speed_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel {font-size: 12px;}&quot;</span><span class="p">)</span>
            <span class="n">playback_speed_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playback_speed_spin</span><span class="p">)</span>
            <span class="n">playback_speed_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">playback_speed_label</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spin_play_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span>
                <span class="n">playback_speed_widget</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignTop</span>
            <span class="p">)</span>

        <span class="c1"># Main layout for the index selector</span>
        <span class="n">index_selection_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">index_selection_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="p">)</span>
        <span class="n">index_selection_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">spin_play_widget</span><span class="p">)</span>
        <span class="n">index_selection_layout</span><span class="o">.</span><span class="n">addSpacerItem</span><span class="p">(</span>
            <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">index_selection_layout</span><span class="p">)</span>

        <span class="n">spin_play_widget</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        QSpinBox {</span>
<span class="s2">            font-size: 14px;</span>
<span class="s2">            padding: 3px 6px;    /* Inner spacing (top/bottom, left/right) */</span>
<span class="s2">            min-width: 60px;     /* Minimum width */</span>
<span class="s2">            min-height: 20px;    /* Minimum height */</span>
<span class="s2">            text-align: center;  /* Text alignment */</span>
<span class="s2">        }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># spin_play_widget.setStyleSheet(&quot;QLabel {font-size: 14px;}&quot;)</span>

        <span class="k">if</span> <span class="n">include_play_button</span><span class="p">:</span>
            <span class="c1"># Timer for playback</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_timer</span><span class="o">.</span><span class="n">setInterval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playback_speed_spin</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>  <span class="c1"># milliseconds per frame</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_additional_spinbox_indexing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">new_indexing</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">sort_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_selected_value_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">indexing</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_indexing</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sort_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">use_indexing</span> <span class="o">=</span> <span class="n">indexing</span><span class="p">[</span><span class="n">sort_idx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">use_indexing</span> <span class="o">=</span> <span class="n">indexing</span>
            <span class="k">if</span> <span class="n">new_selected_value_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">new_selected_value_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="n">new_selected_value_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extra_spinboxes_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_allowed_values</span><span class="p">(</span><span class="n">use_indexing</span><span class="p">,</span> <span class="n">set_value_to</span><span class="o">=</span><span class="n">new_value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_on_playback_speed_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_timer</span><span class="o">.</span><span class="n">setInterval</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ValidatedSpinBox</span><span class="p">(</span><span class="n">QSpinBox</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    QSpinBox that only accepts values from a discrete allowed set.</span>

<span class="sd">    - Preserves the input order of allowed_values (no sorting).</span>
<span class="sd">    - While typing, prefixes of allowed values are permitted (Intermediate).</span>
<span class="sd">    - Up/down arrows jump to the numerically closest next/previous allowed value.</span>
<span class="sd">    - allowed_values can be updated at runtime via set_allowed_values(...).</span>
<span class="sd">    - Optionally confirm only on Enter/focus-out via setKeyboardTracking(False).</span>

<span class="sd">    Note: this was primarily created by chatGPT5</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allowed_values</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_allowed_core</span><span class="p">(</span><span class="n">allowed_values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sorted_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setKeyboardTracking</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># confirm on Enter/focus-out (nice UX)</span>

    <span class="c1"># ---------- Public API ----------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_allowed_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">allowed_values</span><span class="p">,</span> <span class="n">set_value_to</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>  <span class="c1"># *, reconcile=&quot;nearest&quot;):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the allowed values after construction.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        allowed_values : Iterable[int]</span>
<span class="sd">            New allowed integer values (deduplicated, preserving first occurrence).</span>
<span class="sd">        reconcile : {&quot;nearest&quot;,&quot;min&quot;,&quot;max&quot;}</span>
<span class="sd">            If current value not in new set:</span>
<span class="sd">              - &quot;nearest&quot;: snap to numerically closest allowed value (default)</span>
<span class="sd">              - &quot;min&quot;:     snap to the minimum of the new set</span>
<span class="sd">              - &quot;max&quot;:     snap to the maximum of the new set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if not allowed_values:</span>
        <span class="c1">#     raise ValueError(&quot;allowed_values must be non-empty&quot;)</span>

        <span class="c1"># cur = self.value()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_allowed_core</span><span class="p">(</span><span class="n">allowed_values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sorted_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">set_value_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">set_value_to</span><span class="p">)</span>

        <span class="c1"># if cur not in self._set_vals:</span>
        <span class="c1">#     if reconcile == &quot;min&quot;:</span>
        <span class="c1">#         target = self._sorted_vals[0]</span>
        <span class="c1">#     elif reconcile == &quot;max&quot;:</span>
        <span class="c1">#         target = self._sorted_vals[-1]</span>
        <span class="c1">#     else:  # &quot;nearest&quot;</span>
        <span class="c1">#         target = self._nearest(cur)</span>
        <span class="c1">#     if target != self.value():</span>
        <span class="c1">#         self.setValue(target)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">allowedValues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the allowed values in the original input order.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_values</span><span class="p">)</span>

    <span class="c1"># ---------- Internals ----------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_set_allowed_core</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allowed_values</span><span class="p">):</span>
        <span class="c1"># Deduplicate while preserving first occurrence (and cast to int)</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">allowed_values</span><span class="p">:</span>
            <span class="n">iv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iv</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">iv</span><span class="p">)</span>
                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iv</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">vals</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;allowed_values must be non-empty&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_values</span> <span class="o">=</span> <span class="n">vals</span>  <span class="c1"># original order (public)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_vals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>  <span class="c1"># membership tests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>  <span class="c1"># numeric stepping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allowed_strs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]</span>  <span class="c1"># for prefix typing</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_prefix_of_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">neg</span> <span class="k">else</span> <span class="n">s</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">body</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Allow leading zeros while typing</span>
        <span class="n">s_no_zeros</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="k">if</span> <span class="n">neg</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">asv</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="n">asv</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">s_no_zeros</span><span class="p">)</span> <span class="k">for</span> <span class="n">asv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allowed_strs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_nearest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return numerically closest value in _sorted_vals to x (ties -&gt; smaller).&quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_vals</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">before</span><span class="p">,</span> <span class="n">after</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># tie-break toward the smaller (consistent, predictable)</span>
        <span class="k">return</span> <span class="n">before</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">before</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">after</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">after</span>

    <span class="c1"># ---------- QAbstractSpinBox overrides ----------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">QValidator</span><span class="o">.</span><span class="n">Intermediate</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_prefix_of_allowed</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">else</span> <span class="n">QValidator</span><span class="o">.</span><span class="n">Invalid</span><span class="p">,</span>
                <span class="n">text</span><span class="p">,</span>
                <span class="n">pos</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_vals</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">QValidator</span><span class="o">.</span><span class="n">Acceptable</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_prefix_of_allowed</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">QValidator</span><span class="o">.</span><span class="n">Intermediate</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">QValidator</span><span class="o">.</span><span class="n">Invalid</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fixup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="c1"># On commit with invalid text, keep current valid value</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">valueFromText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">textFromValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stepBy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Step to the numerically next/previous allowed value, regardless of</span>
<span class="sd">        input order. Supports multi-step (e.g., steps=2).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">steps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_vals</span>

        <span class="c1"># If current value is not on-grid, snap to nearest first</span>
        <span class="k">if</span> <span class="n">cur</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_vals</span><span class="p">:</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nearest</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>

        <span class="c1"># Use bisect to find neighbors; loop for |steps| times</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">steps</span><span class="p">)):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">cur</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">steps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># move to strictly greater value if possible</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cur</span><span class="p">:</span>
                    <span class="n">cur</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># i points to current or end; go to next index if exists</span>
                    <span class="n">next_i</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">cur</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">next_i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># move to strictly smaller value if possible</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># a[i-1] is &lt; cur (or == if off-grid handled above)</span>
                    <span class="n">cur</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">or</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cur</span><span class="p">)</span> <span class="k">else</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cur</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>


<div class="viewcode-block" id="launch_array_viewer">
<a class="viewcode-back" href="../../../../_autosummary/pyxalign.gui.html#pyxalign.gui.launch_array_viewer">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">launch_array_viewer</span><span class="p">(</span>
    <span class="n">array3d</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayViewerOptions</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sort_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">extra_title_strings_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">process_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">wait_until_closed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span> <span class="ow">or</span> <span class="n">QApplication</span><span class="p">([])</span>
    <span class="n">gui</span> <span class="o">=</span> <span class="n">ArrayViewer</span><span class="p">(</span>
        <span class="n">array3d</span><span class="p">,</span>
        <span class="n">options</span><span class="p">,</span>
        <span class="n">sort_idx</span><span class="p">,</span>
        <span class="n">extra_title_strings_list</span><span class="o">=</span><span class="n">extra_title_strings_list</span><span class="p">,</span>
        <span class="n">process_func</span><span class="o">=</span><span class="n">process_func</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WA_DeleteOnClose</span><span class="p">)</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">wait_until_closed</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">gui</span></div>



<div class="viewcode-block" id="launch_linked_array_viewer">
<a class="viewcode-back" href="../../../../_autosummary/pyxalign.gui.html#pyxalign.gui.launch_linked_array_viewer">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">launch_linked_array_viewer</span><span class="p">(</span>
    <span class="n">array_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayViewerOptions</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sort_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">extra_title_strings_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">process_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">wait_until_closed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span> <span class="ow">or</span> <span class="n">QApplication</span><span class="p">([])</span>
    <span class="n">gui</span> <span class="o">=</span> <span class="n">LinkedArrayViewer</span><span class="p">(</span>
        <span class="n">array_list</span><span class="p">,</span>
        <span class="n">options</span><span class="p">,</span>
        <span class="n">sort_idx</span><span class="p">,</span>
        <span class="n">extra_title_strings_list</span><span class="o">=</span><span class="n">extra_title_strings_list</span><span class="p">,</span>
        <span class="n">process_func</span><span class="o">=</span><span class="n">process_func</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WA_DeleteOnClose</span><span class="p">)</span>
    <span class="n">gui</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">wait_until_closed</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">gui</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">pyxalign</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Argonne National Laboratory.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>